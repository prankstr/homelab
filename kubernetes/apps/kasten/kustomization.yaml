apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  - oidc-secret.yaml
  - vmpodscrape.yaml
  - vmscrapeconfig.yaml

patches:
  - path: rbac-patch.yaml
    target:
      group: rbac.authorization.k8s.io
      kind: ClusterRoleBinding
      name: kasten-cluster-admin
      version: v1

generatorOptions:
  disableNameSuffixHash: true
  labels:
    grafana_dashboard: "1"

configMapGenerator:
  - files:
      - kasten-dashboard.json
    name: kasten-dashboard

# Need to set namespace here as well, otherwise some resources are created in the wrong namespace
helmCharts:
  - includeCRDs: true
    name: k10
    namespace: kasten
    releaseName: k10 
    repo: https://charts.kasten.io
    valuesFile: values.yaml
    version: 8.0.10
