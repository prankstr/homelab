apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  - namespace.yaml
  - static-scrapes.yaml
  - datasource.yaml
  - alertmanager-config-secret.yaml
  - homeassistant-token-secret.yaml

patches:
  - path: server-side-apply-patch.yaml
    target:
      kind: ConfigMap
      name: victoria-metrics-k8s-stack-vmagent
  - path: server-side-apply-patch.yaml
    target:
      kind: ConfigMap
      name: victoria-metrics-k8s-stack-victoriametrics
  - path: coredns-patch.yaml
    target:
      kind: Service
      name: victoria-metrics-k8s-stack-coredns

helmCharts:
  - includeCRDs: true
    name: victoria-metrics-k8s-stack
    namespace: victoria-metrics
    releaseName: victoria-metrics-k8s-stack
    repo: https://victoriametrics.github.io/helm-charts/
    valuesFile: values.yaml
    version: 0.23.4

  - name: victoria-metrics-agent
    namespace: victoria-metrics
    releaseName: external-monitoring
    repo: https://victoriametrics.github.io/helm-charts/
    valuesFile: values-external.yaml
    version: 0.10.9

  - name: victoria-logs-single
    repo: https://victoriametrics.github.io/helm-charts/
    namespace: victoria-metrics
    includeCRDs: true
    releaseName: victoria-logs-single
    valuesFile: values-logs.yaml
    version: 0.5.2
